import{d as w,ar as A,as as I,at as R,H as f,af as U,e as S,C as M,au as C,_ as N,r as b,f as m,k as e,p as g,w as y,o as _,m as $,F as v,i as E,l as k,z as B}from"./index.673a3d36.js";import{g as x}from"./assets.6445f516.js";import{a as V}from"./account.de44acad.js";import{M as F}from"./multiselect.901b9aab.js";import{S as D}from"./sweetalert2.8ac2e1c4.js";import{c as T,a as P}from"./object.a5e03688.js";const q=w({name:"user-account-profile",components:{ErrorMessage:A,Field:I,VForm:R,Multiselect:F},data(){return{menuData:[]}},async mounted(){await f.get("http://localhost:3100/api/getProfileApp_By_IdApi").then(async t=>{let r=t.data[0].UserRule_Id;const s="2",c="7",h=!0;await f.get(`http://localhost:3100/api/ListMenuById/${r}`).then(l=>{const d=l.data[0].MainMenu.find(n=>n.MainMenu_Id===s);if(d){const n=d.SubMenu.find(u=>u.SubMenu_Id===c);n&&n.Active===h?this.loadData(this.$route.params.id):U.push("/notPermission")}})}).catch(t=>{console.log(t)})},methods:{async loadData(t){this.menuData=[];try{const a=await f.get(`http://localhost:3100/api/ListMenuById/${t}`);this.menuData=a.data}catch(a){console.error("Error fetching data:",a)}},async onSubmitSaveChanges(t,a){let r=!0,s="";S();const c=this.$route.params.id,h={UserRule_Name:t.UserRule_Name,UserRule_Delete:"0"};try{await f.put(`http://localhost:3100/api/updateUserRules/${c}`,h).then(i=>{s=i.data.message}).catch(i=>{console.error("An error occurred:",i),r=!1,s="An error occurred:"+i});const l=[];for(const i of this.menuData)for(const d of i.MainMenu)for(const n of d.SubMenu){const u={UserRule_Id:c,MainMenu_Id:d.MainMenu_Id.toString(),SubMenu_Id:n.SubMenu_Id.toString(),UserRuleDetail_Delete:"0"};console.log(u);const p=f.delete(`http://localhost:3100/api/delUserRulesDetail/${c}
                                                                                        /${d.MainMenu_Id.toString()}
                                                                                        /${n.SubMenu_Id.toString()}`).then(()=>{}).catch(o=>{console.error("An error occurred:",o),r=!1,s="An error occurred: "+o});l.push(p),n.Active==!0&&l.push(f.post("http://localhost:3100/api/createUserRulesDetail",u).then(()=>{}).catch(o=>{console.error("An error occurred:",o),r=!1,s="An error occurred: "+o}))}await Promise.all(l),(r=!0)?D.fire({text:s,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok, got it!",heightAuto:!1,customClass:{confirmButton:"btn fw-semobold btn-light-primary"}}).then(async()=>{await this.loadData(c)}):D.fire({text:"Error inserting data:"+s,icon:"error",buttonsStyling:!1,confirmButtonText:"Try again!",heightAuto:!1,customClass:{confirmButton:"btn fw-semobold btn-light-danger"}})}catch(l){console.error("Error inserting data:",l)}}},setup(){S(),V();const t=M({}),a=M({}),r=M(null),s=h=>{h.Active=!h.Active},c=T().shape({UserRule_Name:P().required().label("UserRule_Name")});return{toggleSubMenuActive:s,getAssetPath:x,submitButton:r,userDetail:c,myPrefix:a,nameTitle:t,Tooltip:C}}}),L={class:"card mb-5 mb-xl-10"},j=e("div",{class:"card-header border-0","data-bs-target":"#kt_account_profile","aria-expanded":"true","aria-controls":"kt_account_profile"},[e("div",{class:"card-title m-0"},[e("h3",{class:"fw-medium m-0"},"\u0E41\u0E01\u0E49\u0E44\u0E02\u0E15\u0E31\u0E49\u0E07\u0E04\u0E48\u0E32\u0E2A\u0E34\u0E17\u0E18\u0E34\u0E4C")])],-1),z={id:"kt_account_profile"},H={class:"card-body border-top p-9"},O={key:0,class:"row mb-6"},G=e("label",{class:"col-lg-4 col-form-label required fw-semobold fs-6"},"\u0E2A\u0E34\u0E17\u0E18\u0E34\u0E4C",-1),J={class:"col-lg-8 fv-row"},K={class:"fv-plugins-message-container"},Q={class:"fv-help-block"},W={class:"col-lg-4 col-form-label fw-semobold fs-6"},X={class:"col-lg-8 fv-row"},Y=["name","checked","onChange"],Z={class:"col-lg-4 col-form-label fw-semobold fs-6"},ee={class:"card-footer d-flex justify-content-end py-6 px-9"},te=e("button",{type:"reset",class:"btn btn-light btn-active-light-second me-2"}," Discard ",-1),se={type:"submit",id:"kt_account_profile_details_submit",ref:"submitButton",class:"btn btn-success"},oe=e("span",{class:"indicator-label"}," Save ",-1),ae=e("span",{class:"indicator-progress"},[B(" Please wait... "),e("span",{class:"spinner-border spinner-border-sm align-middle ms-2"})],-1),ne=[oe,ae];function re(t,a,r,s,c,h){const l=b("Field"),i=b("ErrorMessage"),d=b("router-link"),n=b("VForm");return _(),m("div",L,[j,e("div",z,[g(n,{id:"kt_account_profile_form",class:"form",novalidate:"",onSubmit:t.onSubmitSaveChanges,"validation-schema":t.userDetail},{default:y(()=>[e("div",H,[t.menuData.length>0?(_(),m("div",O,[G,e("div",J,[g(l,{type:"text",name:"UserRule_Name",class:"form-control form-control-lg form-control-solid",placeholder:"",modelValue:t.menuData[0].UserRule_Name,"onUpdate:modelValue":a[0]||(a[0]=u=>t.menuData[0].UserRule_Name=u)},null,8,["modelValue"]),e("div",K,[e("div",Q,[g(i,{name:"UserRule_Name"})])])])])):$("",!0),(_(!0),m(v,null,E(t.menuData,u=>(_(),m("div",{key:u.UserRule_Name},[(_(!0),m(v,null,E(u.MainMenu,p=>(_(),m("div",{key:p.MainMenu_Id,class:"row mb-6"},[e("label",W,k(p.MainMenu_Name),1),e("div",X,[(_(!0),m(v,null,E(p.SubMenu,o=>(_(),m("div",{key:o.SubMenu_Id,class:"form-check form-check-solid mt-2"},[e("input",{type:"checkbox",name:"status_"+o.SubMenu_Id,class:"form-check-input",checked:o.Active,onChange:ce=>t.toggleSubMenuActive(o)},null,40,Y),e("label",Z,k(o.SubMenu_Name),1)]))),128))])]))),128))]))),128))]),e("div",ee,[g(d,{to:"/csh_rule_sea/index"},{default:y(()=>[te]),_:1}),e("button",se,ne,512)])]),_:1},8,["onSubmit","validation-schema"])])])}const he=N(q,[["render",re]]);export{he as default};
